# Отчет по лабораторной работе №2
# Организация данных и системный каталог

## Сведения о студенте
**Дата:** [2004-10-28]
**Семестр:** 7
**Группа:** ПИЖ-б-о-22-1
**Дисциплина:** Администрирование баз данных
**Студент:** Горчаков Роман Владимирович

## Цель работы
Всестороннее изучение логической и физической структуры хранения данных в PostgreSQL.
Получение практических навыков управления базами данных, схемами, табличными пространствами.
Глубокое освоение работы с системным каталогом для извлечения метаинформации.
Исследование низкоуровневых аспектов хранения, включая TOAST.

## Теоретическая часть
### Изученные концепции
- Низкоуровневое хранение: организация информации на диске, которая включает структуру данных, механизмы и подходы для оптимизации.

### Ключевые термины
- **База данных:** основной контейнер для хранения данных, который содержит все связанные объекты.
- **Схема:** логический контейнер внутри базы данных, который используется для организации и группировки объектов.
- **Табличное пространство:** место на диске, где хранятся объекты базы данных.
- **Системный каталог:** набор системных таблиц и представлений, содержащих метаданные.
- **TOAST:** механизм для эффективного хранения и управления большими значениями данных.
- **Нежурналируемые таблицы:** таблицы, которые не записывают изменения в журнал предзаписи, в отличие от обычных таблиц.

## Практическая часть

### Модуль 1: Базы данных и схемы

#### Задача 1: Создание и проверка БД
**Цель:** Создать новую базу данных и проверить её начальный размер с помощью pg_database_size('lab02_db').

**Выполненные действия:**
create database lab02_db;
select pg_database_size('lab02_db');

**Результаты:**
 pg_database_size 
------------------
          7602703
(1 row)

#### Задача 2: Работа со схемами
**Цель:** Подключиться к lab02_db, создать схему app и схему с именем пользователя ОС, создать в каждой схеме по одной таблице и вставить в них данные.

**Выполненные действия:**
1. psql -d lab02_db -U student;
2. create schema app;
3. create schema student;
4. create table app.users (
    user_id serial primary key,
    username varchar(50) not null unique,
    email varchar(100) not null unique
);
5. create table student.courses (
    course_id serial primary key,
    course_name varchar(100) not null
);
6. insert into app.users (username, email) values
    ('alice', 'alice@gmail.com'),
    ('bob', 'bob@gmail.com'),
    ('charlie', 'charlie@gmail.com');
7. insert into student.courses (course_name) values
    ('Software Engineering'),
    ('Project Management'),
    ('Database Administration'),
    ('Big Data');

**Результаты:**
2. CREATE SCHEMA
3. CREATE SCHEMA
4. CREATE TABLE
5. CREATE TABLE
6. INSERT 0 3
7. INSERT 0 4

#### Задача 3: Контроль размера
**Цель:** Снова проверить размер базы данных и объяснить его изменение.

**Выполненные действия:**
select pg_database_size('lab02_db');

**Результаты:**
 pg_database_size 
------------------
          7918051
(1 row)

**Выводы и объяснения:**
Команда pg_database_size('') возвращает размер базы данных в байтах. Так как после добавления схем, таблиц и их заполнения размер базы данных увеличился, то и выводимое число увеличилось тоже.

#### Задача 4: Управление путем поиска
**Цель:** Настроить параметр search_path для текущего сеанса так, чтобы при обращении по неполному имени приоритет имела новая пользовательская схема, а затем схема app, и продемонстрировать работу, обратившись к таблицам без указания схемы.

**Выполненные действия:**
1. set search_path to student, app;
2. select * from courses;
3. select * from users;

**Результаты:**
1. SET
2.  course_id |       course_name       
-----------+-------------------------
         1 | software engineering
         2 | project management
         3 | database administration
         4 | big data
(4 rows)
3.  user_id | username |       email       
---------+----------+-------------------
       1 | alice    | alice@gmail.com
       2 | bob      | bob@gmail.com
       3 | charlie  | charlie@gmail.com
(3 rows)

#### Задача 5: Настройка параметра БД
**Цель:** Для базы lab02_db установить значение параметра temp_buffers так, чтобы в каждом новом сеансе, подключенном к этой БД, оно было в 4 раза больше значения по умолчанию, и проверить работу.

**Выполненные действия:**
1. alter database lab02_db set temp_buffers = 32768;
2. explain (analyze, buffers, costs off, timing off, summary off) select * from courses;

**Результаты:**
1. ALTER DATABASE
2.                 QUERY PLAN                  
---------------------------------------------
 Seq Scan on courses (actual rows=4 loops=1)
   Buffers: shared hit=1
(2 rows)

### Модуль 2: Системный каталог

#### Задача 1: Исследование pg_class
**Цель:** Получить описание системной таблицы pg_class (команда \d pg_class).

**Выполненные действия:**
\d pg_class

**Результаты:**
                     Table "pg_catalog.pg_class"
       Column        |     Type     | Collation | Nullable | Default 
---------------------+--------------+-----------+----------+---------
 oid                 | oid          |           | not null | 
 relname             | name         |           | not null | 
 relnamespace        | oid          |           | not null | 
 reltype             | oid          |           | not null | 
 reloftype           | oid          |           | not null | 
 relowner            | oid          |           | not null | 
 relam               | oid          |           | not null | 
 relfilenode         | oid          |           | not null | 
 reltablespace       | oid          |           | not null | 
 relpages            | integer      |           | not null | 
 reltuples           | real         |           | not null | 
 relallvisible       | integer      |           | not null | 
 reltoastrelid       | oid          |           | not null | 
 relhasindex         | boolean      |           | not null | 
 relisshared         | boolean      |           | not null | 
 relpersistence      | "char"       |           | not null | 
 relkind             | "char"       |           | not null | 
 relnatts            | smallint     |           | not null | 
 relchecks           | smallint     |           | not null | 
 relhasrules         | boolean      |           | not null | 
 relhastriggers      | boolean      |           | not null | 
 relhassubclass      | boolean      |           | not null | 
 relrowsecurity      | boolean      |           | not null | 
 relforcerowsecurity | boolean      |           | not null | 
 relispopulated      | boolean      |           | not null | 
 relreplident        | "char"       |           | not null | 
 relispartition      | boolean      |           | not null | 
 relrewrite          | oid          |           | not null | 
 relfrozenxid        | xid          |           | not null | 
 relminmxid          | xid          |           | not null | 
 relacl              | aclitem[]    |           |          | 
 reloptions          | text[]       | C         |          | 
 relpartbound        | pg_node_tree | C         |          | 
Indexes:
    "pg_class_oid_index" PRIMARY KEY, btree (oid)
    "pg_class_relname_nsp_index" UNIQUE CONSTRAINT, btree (relname, relnamespace)
    "pg_class_tblspc_relfilenode_index" btree (reltablespace, relfilenode)

(END)

#### Задача 2: Исследование pg_tables
**Цель:** Получить подробное описание представления pg_tables (команда \d+ pg_tables) и объяснить разницу между таблицей и представлением.

**Выполненные действия:**
\d+ pg_tables

**Результаты:**
                          View "pg_catalog.pg_tables"
   Column    |  Type   | Collation | Nullable | Default | Storage | Description 
-------------+---------+-----------+----------+---------+---------+-------------
 schemaname  | name    |           |          |         | plain   | 
 tablename   | name    |           |          |         | plain   | 
 tableowner  | name    |           |          |         | plain   | 
 tablespace  | name    |           |          |         | plain   | 
 hasindexes  | boolean |           |          |         | plain   | 
 hasrules    | boolean |           |          |         | plain   | 
 hastriggers | boolean |           |          |         | plain   | 
 rowsecurity | boolean |           |          |         | plain   | 
View definition:
 SELECT n.nspname AS schemaname,
    c.relname AS tablename,
    pg_get_userbyid(c.relowner) AS tableowner,
    t.spcname AS tablespace,
    c.relhasindex AS hasindexes,
    c.relhasrules AS hasrules,
    c.relhastriggers AS hastriggers,
    c.relrowsecurity AS rowsecurity
   FROM pg_class c
     LEFT JOIN pg_namespace n ON n.oid = c.relnamespace
     LEFT JOIN pg_tablespace t ON t.oid = c.reltablespace
  WHERE c.relkind = ANY (ARRAY['r'::"char", 'p'::"char"]);

**Выводы и объяснения:**
Таблица - физическая структура базы данных, в которой хранятся данные. Представление не хранит данные физически. Вместо этого она содержит запрос (SQL-выражение), который выполняется при обращении к представлению. Данные в представлении извлекаются в реальном времени из одной или нескольких таблиц.

#### Задача 3: Временная таблица и список схем
**Цель:** В базе lab02_db создать временную таблицу, получить полный список всех схем в этой БД, включая системные (pg_catalog, information_schema), и объяснить наличие временной схемы.

**Выполненные действия:**
1. create temp table temp_example (
    id serial,
    name varchar(50)
);
2. select schema_name from information_schema.schemata order by schema_name;

**Результаты:**
1. CREATE TABLE
2.    schema_name     
--------------------
 app
 information_schema
 pg_catalog
 pg_temp_6
 pg_toast
 pg_toast_temp_6
 public
 student
(8 rows)

**Выводы и объяснения:**
В PostgreSQL временные таблицы создаются в специальной временной схеме, которая автоматически генерируется при первом создании временной таблицы в сессии. Имя временной схемы имеет формат pg_temp_N, где N - номер сессии. В нашем случае это pg_temp_6.

#### Задача 4: Представления information_schema
**Цель:** Получить список всех представлений в схеме information_schema.

**Выполненные действия:**
select * from information_schema.views;

**Результаты:**
 table_catalog |    table_schema    |              table_name               |                                                                                                                                                                                                                                                                                                              view_definition                                                                                                                                                                                                                                                                                                               | check_option | is_updatable | is_insertable_into | is_trigger_updatable | is_trigger_deletable | is_trigger_insertable_into 
---------------+--------------------+---------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------+--------------+--------------------+----------------------+----------------------+----------------------------
 lab02_db      | pg_catalog         | pg_shadow                             |  SELECT pg_authid.rolname AS usename,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     +| NONE         | NO           | NO                 | NO                   | NO                   | NO
               |                    |                                       |     pg_authid.oid AS usesysid,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolcreatedb AS usecreatedb,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolsuper AS usesuper,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolreplication AS userepl,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolbypassrls AS usebypassrls,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolpassword AS passwd,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                        +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolvaliduntil AS valuntil,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  +|              |              |                    |                      |                      | 
               |                    |                                       |     s.setconfig AS useconfig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |    FROM (pg_authid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        +|              |              |                    |                      |                      | 
               |                    |                                       |      LEFT JOIN pg_db_role_setting s ON (((pg_authid.oid = s.setrole) AND (s.setdatabase = (0)::oid))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    +|              |              |                    |                      |                      | 
               |                    |                                       |   WHERE pg_authid.rolcanlogin;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |              |              |                    |                      |                      | 
 lab02_db      | pg_catalog         | pg_roles                              |  SELECT pg_authid.rolname,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +| NONE         | NO           | NO                 | NO                   | NO                   | NO
               |                    |                                       |     pg_authid.rolsuper,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolinherit,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolcreaterole,                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolcreatedb,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolcanlogin,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolreplication,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolconnlimit,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +|              |              |                    |                      |                      | 
               |                    |                                       |     '********'::text AS rolpassword,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolvaliduntil,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.rolbypassrls,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +|              |              |                    |                      |                      | 
               |                    |                                       |     s.setconfig AS rolconfig,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_authid.oid                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +|              |              |                    |                      |                      | 
               |                    |                                       |    FROM (pg_authid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        +|              |              |                    |                      |                      | 
               |                    |                                       |      LEFT JOIN pg_db_role_setting s ON (((pg_authid.oid = s.setrole) AND (s.setdatabase = (0)::oid))));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |              |              |                    |                      |                      | 
 lab02_db      | pg_catalog         | pg_hba_file_rules                     |  SELECT rule_number,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      +| NONE         | NO           | NO                 | NO                   | NO                   | NO
               |                    |                                       |     file_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +|              |              |                    |                      |                      | 
               |                    |                                       |     line_number,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +|              |              |                    |                      |                      | 
               |                    |                                       |     type,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +|              |              |                    |                      |                      | 
               |                    |                                       |     database,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +|              |              |                    |                      |                      | 
               |                    |                                       |     user_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +|              |              |                    |                      |                      | 
               |                    |                                       |     address,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                        +|              |              |                    |                      |                      | 
               |                    |                                       |     netmask,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     auth_method,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +|              |              |                    |                      |                      | 
               |                    |                                       |     options,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +|              |              |                    |                      |                      | 
               |                    |                                       |    FROM pg_hba_file_rules() a(rule_number, file_name, line_number, type, database, user_name, address, netmask, auth_method, options, error);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |              |              |                    |                      |                      | 
 lab02_db      | pg_catalog         | pg_settings                           |  SELECT name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +| NONE         | NO           | NO                 | NO                   | NO                   | NO
               |                    |                                       |     setting,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     unit,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +|              |              |                    |                      |                      | 
               |                    |                                       |     category,                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +|              |              |                    |                      |                      | 
               |                    |                                       |     short_desc,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +|              |              |                    |                      |                      | 
               |                    |                                       |     extra_desc,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +|              |              |                    |                      |                      | 
               |                    |                                       |     context,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     vartype,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     source,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +|              |              |                    |                      |                      | 
               |                    |                                       |     min_val,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     max_val,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     enumvals,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +|              |              |                    |                      |                      | 
               |                    |                                       |     boot_val,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                        +|              |              |                    |                      |                      | 
               |                    |                                       |     reset_val,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +|              |              |                    |                      |                      | 
               |                    |                                       |     sourcefile,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +|              |              |                    |                      |                      | 
               |                    |                                       |     sourceline,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +|              |              |                    |                      |                      | 
               |                    |                                       |     pending_restart                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +|              |              |                    |                      |                      | 
               |                    |                                       |    FROM pg_show_all_settings() a(name, setting, unit, category, short_desc, extra_desc, context, vartype, source, min_val, max_val, enumvals, boot_val, reset_val, sourcefile, sourceline, pending_restart);                                                                                                                                                                                                                                                                                                                                                                                                                               |              |              |                    |                      |                      | 
 lab02_db      | pg_catalog         | pg_file_settings                      |  SELECT sourcefile,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +| NONE         | NO           | NO                 | NO                   | NO                   | NO
               |                    |                                       |     sourceline,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +|              |              |                    |                      |                      | 
               |                    |                                       |     seqno,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +|              |              |                    |                      |                      | 
               |                    |                                       |     name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                        +|              |              |                    |                      |                      | 
               |                    |                                       |     setting,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     applied,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +|              |              |                    |                      |                      | 
               |                    |                                       |     error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +|              |              |                    |                      |                      | 
               |                    |                                       |    FROM pg_show_all_file_settings() a(sourcefile, sourceline, seqno, name, setting, applied, error);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |              |              |                    |                      |                      | 
 lab02_db      | pg_catalog         | pg_backend_memory_contexts            |  SELECT name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +| NONE         | NO           | NO                 | NO                   | NO                   | NO
               |                    |                                       |     ident,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +|              |              |                    |                      |                      | 
               |                    |                                       |     parent,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +|              |              |                    |                      |                      | 
               |                    |                                       |     level,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +|              |              |                    |                      |                      | 
               |                    |                                       |     total_bytes,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                        +|              |              |                    |                      |                      | 
               |                    |                                       |     total_nblocks,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        +|              |              |                    |                      |                      | 
               |                    |                                       |     free_bytes,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +|              |              |                    |                      |                      | 
               |                    |                                       |     free_chunks,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +|              |              |                    |                      |                      | 
               |                    |                                       |     used_bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +|              |              |                    |                      |                      | 
               |                    |                                       |    FROM pg_get_backend_memory_contexts() pg_get_backend_memory_contexts(name, ident, parent, level, total_bytes, total_nblocks, free_bytes, free_chunks, used_bytes);                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |              |              |                    |                      |                      | 
 lab02_db      | pg_catalog         | pg_ident_file_mappings                |  SELECT map_number,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +| NONE         | NO           | NO                 | NO                   | NO                   | NO
               |                    |                                       |     file_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +|              |              |                    |                      |                      | 
               |                    |                                       |     line_number,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +|              |              |                    |                      |                      | 
               |                    |                                       |     map_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                        +|              |              |                    |                      |                      | 
               |                    |                                       |     sys_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +|              |              |                    |                      |                      | 
               |                    |                                       |     pg_username,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +|              |              |                    |                      |                      | 
               |                    |                                       |     error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +|              |              |                    |                      |                      | 
               |                    |                                       |    FROM pg_ident_file_mappings() a(map_number, file_name, line_number, map_name, sys_name, pg_username, error);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |              |              |                    |                      |                      | 
 lab02_db      | pg_catalog         | pg_config                             |  SELECT name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +| NONE         | NO           | NO                 | NO                   | NO                   | NO
               |                    |                                       |     setting                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +|              |              |                    |                      |                      | 
               |                    |                                       |    FROM pg_config() pg_config(name, setting);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |              |              |                    |                      |                      | 
 lab02_db      | pg_catalog         | pg_shmem_allocations                  |  SELECT name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +| NONE         | NO           | NO                 | NO                   | NO                   | NO
               |                    |                                       |     off,                                                                                                     

#### Задача 5: Анализ метакоманды
**Цель:** Выполнить в psql команду \d+ pg_views, изучить вывод и объяснить, какие запросы к системному каталогу скрыты за этой командой.

**Выполненные действия:**
\d+ pg_views

**Результаты:**
                         View "pg_catalog.pg_views"
   Column   | Type | Collation | Nullable | Default | Storage  | Description 
------------+------+-----------+----------+---------+----------+-------------
 schemaname | name |           |          |         | plain    | 
 viewname   | name |           |          |         | plain    | 
 viewowner  | name |           |          |         | plain    | 
 definition | text |           |          |         | extended | 
View definition:
 SELECT n.nspname AS schemaname,
    c.relname AS viewname,
    pg_get_userbyid(c.relowner) AS viewowner,
    pg_get_viewdef(c.oid) AS definition
   FROM pg_class c
     LEFT JOIN pg_namespace n ON n.oid = c.relnamespace
  WHERE c.relkind = 'v'::"char";

**Выводы и объяснения:**
За командой \d+ pg_views скрыты запросы к таблицам системного каталога. PostgreSQL использует схему pg_catalog для хранения метаданных, включая информацию о представлениях.

## Результаты выполнения

### Сводная таблица результатов
| Модуль | Задача | Статус | Ключевые наблюдения |
|--------|--------|--------|---------------------|
| 1 | 1 | ✅ Выполнено | pg_database_size('') возвращает размер базы данных в байтах |
| 1 | 2 | ✅ Выполнено | Команда psql -d database -U user позволяет подключиться к базе данных |
| 1 | 3 | ✅ Выполнено | Число, появившееся после команды pg_database_size(''), увеличилось при заполнении таблиц |
| 1 | 4 | ✅ Выполнено | search_path определяет порядок, в котором просматриваются схемы при поиске объекта, к которому обращаются по имени, без указания схемы |
| 1 | 5 | ✅ Выполнено | temp_buffers задаёт максимальный объём памяти, выделяемый для временных таблиц в каждом сеансе базы данных |
| 2 | 1 | ✅ Выполнено | pg_class хранит метаданные обо всех отношениях в базе данных |
| 2 | 2 | ✅ Выполнено | pg_tables содержит список доступных таблиц в текущей базе данных |
| 2 | 3 | ✅ Выполнено | Имя временной схемы зависит от номера текущей сессии |
| 2 | 4 | ✅ Выполнено | Представление information_schema.views возвращает информацию о всех представлениях в текущей базе данных |
| 2 | 5 | ✅ Выполнено | pg_views перечисляет доступные представления в текущей базе данных. |

## Анализ и выводы

### Основные наблюдения
1. pg_class - это системная таблица системного каталога, которая содержит информацию обо всех отношениях в базе данных.
2. pg_tables - системное представление, которое содержит список доступных таблиц в текущей базе данных.
3. pg_database - это таблица системного каталога, которая хранит информацию о доступных базах данных. В отличие от большинства системных каталогов, pg_database общие для всего кластера: есть только один экземпляр этой таблицы в кластере, а не отдельные в каждой базе данных.
4. pg_tablespace в PostgreSQL - каталог в файловой системе, где хранятся файлы объектов базы данных (таблиц, индексов, последовательностей и др.). Табличные пространства позволяют администраторам определять местоположения в файловой системе, где могут находиться файлы, содержащие объекты базы данных. После создания на табличное пространство можно ссылаться по имени при создании объектов базы данных.
5. search_path - список схем, которые база данных использует для поиска объектов. При выполнении запроса PostgreSQL проверяет схемы в порядке их перечисления в пути поиска. Если находит объект в первой схеме, использует его, если нет - переходит к следующей схеме в списке. По умолчанию в путь поиска входит схема «public», в которой создаётся большинство объектов, если не указано иное.
6. temp_buffers - это параметр, который задает максимальный объём памяти, выделяемый для временных таблиц (буферов) в каждом сеансе. Эти буферы используются исключительно для работы с временными таблицами. Значение по умолчанию — 8 мегабайт.
7. Всего существует 4 стратегии хранения: PLAIN (не допускает ни сжатия, ни отдельного хранения; также отключает использование однобайтовых заголовков для типов varlena), EXTENDED (допускает как сжатие, так и хранение; значение по умолчанию для большинства типов данных, поддерживаемых TOAST), EXTERNAL (допускает только хранение без сжатия; по умолчанию эта стратегия не используется для большинства типов данных) и MAIN (допускает только сжатие без хранения; стратегия для типов INET, CIDR и NUMERIC).